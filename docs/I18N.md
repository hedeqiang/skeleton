# å›½é™…åŒ– (i18n) å¤šè¯­è¨€æ”¯æŒ

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å›½é™…åŒ–åŠŸèƒ½ï¼Œæ”¯æŒå¤šè¯­è¨€åˆ‡æ¢ã€‚

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [API ä½¿ç”¨](#api-ä½¿ç”¨)
- [æ¶ˆæ¯æ–‡ä»¶ç®¡ç†](#æ¶ˆæ¯æ–‡ä»¶ç®¡ç†)
- [é”™è¯¯æ¶ˆæ¯å›½é™…åŒ–](#é”™è¯¯æ¶ˆæ¯å›½é™…åŒ–)
- [ä¸­é—´ä»¶ä½¿ç”¨](#ä¸­é—´ä»¶ä½¿ç”¨)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## æ¦‚è¿°

é¡¹ç›®é‡‡ç”¨äº†ç°ä»£åŒ–çš„ i18n è§£å†³æ–¹æ¡ˆï¼š

- **æ ¸å¿ƒåº“**: `nicksnyder/go-i18n/v2` - Go ç”Ÿæ€æœ€ä¸»æµçš„å›½é™…åŒ–åº“
- **è¯­è¨€å¤„ç†**: `golang.org/x/text/language` - å®˜æ–¹è¯­è¨€æ ‡ç­¾å¤„ç†
- **æ¶ˆæ¯æ ¼å¼**: YAML - æ˜“è¯»æ˜“ç»´æŠ¤çš„æ¶ˆæ¯æ–‡ä»¶æ ¼å¼
- **æ¶æ„é›†æˆ**: å®Œæ•´çš„ Wire ä¾èµ–æ³¨å…¥æ”¯æŒ

### æ”¯æŒçš„è¯­è¨€

- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡** (`zh`) - é»˜è®¤è¯­è¨€
- ğŸ‡ºğŸ‡¸ **è‹±æ–‡** (`en`) - å¤‡ç”¨è¯­è¨€

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬é…ç½®

é…ç½®æ–‡ä»¶ `configs/config.dev.yaml`:

```yaml
i18n:
  default_language: "zh"           # é»˜è®¤è¯­è¨€
  support_languages: ["zh", "en"] # æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
  messages_path: "./locales"       # æ¶ˆæ¯æ–‡ä»¶è·¯å¾„
  accept_languages: ["zh", "zh-CN", "zh-Hans", "en", "en-US"]
```

### 2. åœ¨ä»£ç ä¸­ä½¿ç”¨

```go
// åœ¨ Handler ä¸­è·å– i18n å®ä¾‹
func (h *UserHandler) GetUser(c *gin.Context) {
    // ä» context è·å–ç”¨æˆ·è¯­è¨€åå¥½ï¼Œè‡ªåŠ¨ç¿»è¯‘
    message := h.app.I18n.T(c.Request.Context(), "api.user.created", nil)
    
    // å¸¦å‚æ•°çš„æ¶ˆæ¯ç¿»è¯‘
    welcome := h.app.I18n.T(c.Request.Context(), "common.hello", 
        map[string]interface{}{"Name": "å¼ ä¸‰"})
    
    c.JSON(200, gin.H{"message": message, "welcome": welcome})
}
```

### 3. å®¢æˆ·ç«¯è¯­è¨€åˆ‡æ¢

```bash
# é€šè¿‡ HTTP Header è®¾ç½®è¯­è¨€
curl -H "Accept-Language: zh-CN,zh;q=0.9" http://localhost:8080/api/users

# é€šè¿‡æŸ¥è¯¢å‚æ•°è®¾ç½®è¯­è¨€  
curl http://localhost:8080/api/users?lang=en
```

## é…ç½®è¯´æ˜

### I18n é…ç½®ç»“æ„

```go
type I18nConfig struct {
    DefaultLanguage   string   // é»˜è®¤è¯­è¨€ä»£ç 
    SupportLanguages  []string // æ”¯æŒçš„è¯­è¨€ä»£ç åˆ—è¡¨
    MessagesPath      string   // æ¶ˆæ¯æ–‡ä»¶å­˜æ”¾è·¯å¾„
    AcceptLanguages   []string // Accept-Language æ”¯æŒçš„è¯­è¨€æ ‡ç­¾
}
```

### é…ç½®é€‰é¡¹è¯¦è§£

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `default_language` | string | `"zh"` | é»˜è®¤è¯­è¨€ï¼Œå½“æ£€æµ‹ä¸åˆ°ç”¨æˆ·è¯­è¨€æ—¶ä½¿ç”¨ |
| `support_languages` | []string | `["zh", "en"]` | åº”ç”¨æ”¯æŒçš„è¯­è¨€åˆ—è¡¨ |
| `messages_path` | string | `"./locales"` | æ¶ˆæ¯æ–‡ä»¶å­˜æ”¾çš„ç›®å½•è·¯å¾„ |
| `accept_languages` | []string | è§é…ç½®æ–‡ä»¶ | Accept-Language header è¯†åˆ«çš„è¯­è¨€æ ‡ç­¾ |

### ç¯å¢ƒé…ç½®

å¯é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®ï¼š

```bash
# è®¾ç½®é»˜è®¤è¯­è¨€ä¸ºè‹±æ–‡
export I18N_DEFAULT_LANGUAGE=en

# è®¾ç½®æ¶ˆæ¯æ–‡ä»¶è·¯å¾„
export I18N_MESSAGES_PATH=/app/locales
```

## API ä½¿ç”¨

### æ ¸å¿ƒæ¥å£

```go
type I18n struct {
    // ç§æœ‰å­—æ®µ...
}

// ä¸»è¦æ–¹æ³•
func (i *I18n) T(ctx context.Context, messageID string, templateData map[string]interface{}) string
func (i *I18n) TWithLang(lang, messageID string, templateData map[string]interface{}) string
func (i *I18n) GetLocalizer(lang string) *i18n.Localizer
```

### ä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€ç¿»è¯‘

```go
// ç®€å•æ¶ˆæ¯ç¿»è¯‘
message := i18n.T(ctx, "errors.user_not_found", nil)

// å¸¦æ¨¡æ¿å˜é‡çš„ç¿»è¯‘
greeting := i18n.T(ctx, "common.hello", map[string]interface{}{
    "Name": "Alice",
})
```

#### æŒ‡å®šè¯­è¨€ç¿»è¯‘

```go
// ç›´æ¥æŒ‡å®šè¯­è¨€ç¿»è¯‘ï¼Œä¸ä¾èµ– context
zhMessage := i18n.TWithLang("zh", "common.welcome", nil)
enMessage := i18n.TWithLang("en", "common.welcome", nil)
```

#### Context è¯­è¨€ç®¡ç†

```go
// è®¾ç½®è¯­è¨€åˆ° context
ctx := i18n.SetLanguageToContext(context.Background(), "en")

// ä» context è·å–è¯­è¨€
lang := i18n.GetLanguageFromContext(ctx) // è¿”å› "en"
```

#### Accept-Language è§£æ

```go
// è§£æ HTTP Accept-Language header
lang := i18n.ParseAcceptLanguage("zh-CN,zh;q=0.9,en;q=0.8")
// è¿”å›: "zh"

lang = i18n.ParseAcceptLanguage("en-US,en;q=0.9")  
// è¿”å›: "en"

lang = i18n.ParseAcceptLanguage("fr-FR,fr;q=0.9")
// è¿”å›: "zh" (ä¸æ”¯æŒçš„è¯­è¨€è¿”å›é»˜è®¤è¯­è¨€)
```

## æ¶ˆæ¯æ–‡ä»¶ç®¡ç†

### æ–‡ä»¶ç»“æ„

```
locales/
â”œâ”€â”€ zh.yaml    # ä¸­æ–‡æ¶ˆæ¯
â””â”€â”€ en.yaml    # è‹±æ–‡æ¶ˆæ¯
```

### æ¶ˆæ¯æ–‡ä»¶æ ¼å¼

#### ä¸­æ–‡æ¶ˆæ¯æ–‡ä»¶ (`locales/zh.yaml`)

```yaml
# é”™è¯¯æ¶ˆæ¯
errors:
  user_not_found:
    other: "ç”¨æˆ·ä¸å­˜åœ¨"
  user_exists:
    other: "ç”¨æˆ·å·²å­˜åœ¨" 
  invalid_password:
    other: "å¯†ç é”™è¯¯"

# é€šç”¨æ¶ˆæ¯
common:
  success:
    other: "æ“ä½œæˆåŠŸ"
  hello:
    one: "ä½ å¥½ {{.Name}}"
    other: "ä½ å¥½ {{.Name}}"
  welcome:
    other: "æ¬¢è¿ï¼"

# API å“åº”æ¶ˆæ¯
api:
  user:
    created:
      other: "ç”¨æˆ·åˆ›å»ºæˆåŠŸ"
    updated:
      other: "ç”¨æˆ·æ›´æ–°æˆåŠŸ"

# éªŒè¯æ¶ˆæ¯
validation:
  required:
    other: "{{.Field}}æ˜¯å¿…å¡«é¡¹"
  min_length:
    other: "{{.Field}}æœ€å°‘éœ€è¦{{.Min}}ä¸ªå­—ç¬¦"
```

#### è‹±æ–‡æ¶ˆæ¯æ–‡ä»¶ (`locales/en.yaml`)

```yaml
# Error messages
errors:
  user_not_found:
    other: "User not found"
  user_exists:
    other: "User already exists"
  invalid_password:
    other: "Invalid password"

# Common messages  
common:
  success:
    other: "Operation successful"
  hello:
    one: "Hello {{.Name}}"
    other: "Hello {{.Name}}"
  welcome:
    other: "Welcome!"

# API response messages
api:
  user:
    created:
      other: "User created successfully"
    updated:
      other: "User updated successfully"

# Validation messages
validation:
  required:
    other: "{{.Field}} is required"
  min_length:
    other: "{{.Field}} must be at least {{.Min}} characters"
```

### æ¶ˆæ¯é”®å‘½åè§„èŒƒ

- ä½¿ç”¨ `.` åˆ†éš”çš„å±‚çº§ç»“æ„
- é‡‡ç”¨ `snake_case` å‘½åé£æ ¼
- æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç»„ï¼ˆerrorsã€commonã€apiã€validation ç­‰ï¼‰

```yaml
# âœ… æ¨èçš„å‘½åæ–¹å¼
errors.user_not_found
api.user.created  
validation.required

# âŒ ä¸æ¨èçš„å‘½åæ–¹å¼
ErrorUserNotFound
api_user_created
validation-required
```

### å¤æ•°å½¢å¼æ”¯æŒ

```yaml
# æ”¯æŒ CLDR å¤æ•°è§„åˆ™
items_count:
  one: "{{.Count}} item"
  other: "{{.Count}} items"
  
# ä¸­æ–‡é€šå¸¸ä¸åŒºåˆ†å¤æ•°
items_count:
  other: "{{.Count}} ä¸ªé¡¹ç›®"
```

## é”™è¯¯æ¶ˆæ¯å›½é™…åŒ–

### é”™è¯¯ç»“æ„æ‰©å±•

é¡¹ç›®çš„é”™è¯¯ç±»å‹å·²ç»æ‰©å±•æ”¯æŒå›½é™…åŒ–ï¼š

```go
type AppError struct {
    Type      ErrorType              `json:"type"`
    Message   string                 `json:"message"`
    Code      int                    `json:"code"`
    Err       error                  `json:"-"`
    Details   string                 `json:"details,omitempty"`
    MessageID string                 `json:"-"` // i18n æ¶ˆæ¯é”®
    Data      map[string]interface{} `json:"-"` // æ¨¡æ¿æ•°æ®
}
```

### åˆ›å»ºå›½é™…åŒ–é”™è¯¯

```go
// åˆ›å»ºæ”¯æŒ i18n çš„é”™è¯¯
err := errors.NewI18n(errors.ErrorTypeValidation, "validation.required", 
    map[string]interface{}{"Field": "username"})

// åŒ…è£…ç°æœ‰é”™è¯¯ä¸º i18n é”™è¯¯
err = errors.WrapI18n(originalErr, errors.ErrorTypeDatabase, 
    "errors.database_error", nil)
```

### é¢„å®šä¹‰é”™è¯¯

```go
// æ‰€æœ‰é¢„å®šä¹‰é”™è¯¯å·²æ”¯æŒ i18n
var (
    ErrUserNotFound     = NewI18n(ErrorTypeNotFound, "errors.user_not_found", nil)
    ErrUserExists       = NewI18n(ErrorTypeConflict, "errors.user_exists", nil)
    ErrInvalidPassword  = NewI18n(ErrorTypeUnauthorized, "errors.invalid_password", nil)
    // ... æ›´å¤šé”™è¯¯
)
```

### é”™è¯¯æœ¬åœ°åŒ–

```go
// åœ¨ Handler ä¸­è¿”å›æœ¬åœ°åŒ–é”™è¯¯æ¶ˆæ¯
func (h *UserHandler) GetUser(c *gin.Context) {
    user, err := h.userService.GetUser(c.Request.Context(), userID)
    if err != nil {
        if appErr, ok := err.(*errors.AppError); ok {
            // è·å–æœ¬åœ°åŒ–é”™è¯¯æ¶ˆæ¯
            localizedMsg := appErr.LocalizedMessage(c.Request.Context(), h.app.I18n)
            c.JSON(appErr.StatusCode(), gin.H{
                "error": localizedMsg,
                "code":  appErr.Code,
            })
            return
        }
    }
    
    c.JSON(200, user)
}
```

## ä¸­é—´ä»¶ä½¿ç”¨

### i18n ä¸­é—´ä»¶åŠŸèƒ½

è‡ªåŠ¨è¯­è¨€æ£€æµ‹ä¸­é—´ä»¶æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **Accept-Language Header è§£æ** - è‡ªåŠ¨è§£æå®¢æˆ·ç«¯è¯­è¨€åå¥½
2. **æŸ¥è¯¢å‚æ•°æ”¯æŒ** - æ”¯æŒ `?lang=en` å‚æ•°è¦†ç›–
3. **Context æ³¨å…¥** - å°†è¯­è¨€ä¿¡æ¯æ³¨å…¥åˆ°è¯·æ±‚ context
4. **å“åº”å¤´è®¾ç½®** - è®¾ç½® `Content-Language` å“åº”å¤´

### ä¸­é—´ä»¶æ³¨å†Œ

```go
// åœ¨ router/router.go ä¸­è‡ªåŠ¨æ³¨å†Œ
func setupMiddleware(r *gin.Engine, logger *zap.Logger, i18n *i18n.I18n) {
    r.Use(middleware.RequestID())
    r.Use(middleware.NewLogger(logger))
    r.Use(middleware.NewRecovery(logger))
    r.Use(middleware.CORS())
    r.Use(middleware.NewI18n(i18n)) // i18n ä¸­é—´ä»¶
}
```

### è¯­è¨€æ£€æµ‹ä¼˜å…ˆçº§

1. **æŸ¥è¯¢å‚æ•°** (`?lang=en`) - æœ€é«˜ä¼˜å…ˆçº§
2. **Accept-Language Header** - æ¬¡ä¼˜å…ˆçº§
3. **é»˜è®¤è¯­è¨€** - å…œåº•æ–¹æ¡ˆ

```bash
# ä¼˜å…ˆçº§ç¤ºä¾‹
curl -H "Accept-Language: zh-CN" "http://localhost:8080/api?lang=en"
# ç»“æœï¼šä½¿ç”¨è‹±æ–‡ (æŸ¥è¯¢å‚æ•°ä¼˜å…ˆ)

curl -H "Accept-Language: en-US" http://localhost:8080/api  
# ç»“æœï¼šä½¿ç”¨è‹±æ–‡ (Header ç”Ÿæ•ˆ)

curl http://localhost:8080/api
# ç»“æœï¼šä½¿ç”¨ä¸­æ–‡ (é»˜è®¤è¯­è¨€)
```

## æœ€ä½³å®è·µ

### 1. æ¶ˆæ¯æ–‡ä»¶ç»„ç»‡

```yaml
# âœ… æ¨èï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç»„
errors:
  authentication:
    invalid_credentials: "..."
    token_expired: "..."
  validation:
    required_field: "..."
    invalid_format: "..."

api:
  user:
    created: "..."
    updated: "..."
  order:
    placed: "..."
    cancelled: "..."

# âŒ ä¸æ¨èï¼šæ‰å¹³åŒ–ç»“æ„
user_created: "..."
order_placed: "..."
validation_error: "..."
```

### 2. æ¨¡æ¿å˜é‡ä½¿ç”¨

```yaml
# âœ… æ¨èï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å
welcome_message:
  other: "æ¬¢è¿ {{.UserName}}ï¼Œæ‚¨æœ‰ {{.MessageCount}} æ¡æ–°æ¶ˆæ¯"

# âŒ ä¸æ¨èï¼šä½¿ç”¨æ— æ„ä¹‰çš„å˜é‡å  
welcome_message:
  other: "æ¬¢è¿ {{.Arg1}}ï¼Œæ‚¨æœ‰ {{.Arg2}} æ¡æ–°æ¶ˆæ¯"
```

### 3. é”™è¯¯å¤„ç†

```go
// âœ… æ¨èï¼šä½¿ç”¨ i18n é”™è¯¯
func (s *UserService) CreateUser(ctx context.Context, req *CreateUserRequest) error {
    if req.Username == "" {
        return errors.NewI18n(errors.ErrorTypeValidation, "validation.required", 
            map[string]interface{}{"Field": "ç”¨æˆ·å"})
    }
    return nil
}

// âŒ ä¸æ¨èï¼šç¡¬ç¼–ç é”™è¯¯æ¶ˆæ¯
func (s *UserService) CreateUser(ctx context.Context, req *CreateUserRequest) error {
    if req.Username == "" {
        return errors.New("ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    }
    return nil
}
```

### 4. Handler ä¸­çš„ä½¿ç”¨

```go
// âœ… æ¨èï¼šç»Ÿä¸€çš„å“åº”æ ¼å¼
func (h *UserHandler) CreateUser(c *gin.Context) {
    // ... ä¸šåŠ¡é€»è¾‘
    
    successMsg := h.app.I18n.T(c.Request.Context(), "api.user.created", nil)
    c.JSON(201, gin.H{
        "message": successMsg,
        "data":    user,
    })
}
```

### 5. æ¶ˆæ¯é”®ç®¡ç†

```go
// âœ… æ¨èï¼šå®šä¹‰å¸¸é‡é¿å…æ‹¼å†™é”™è¯¯
const (
    MsgUserCreated    = "api.user.created"
    MsgUserNotFound   = "errors.user_not_found"
    MsgValidationReq  = "validation.required"
)

func (h *UserHandler) CreateUser(c *gin.Context) {
    msg := h.app.I18n.T(c.Request.Context(), MsgUserCreated, nil)
    // ...
}
```

### 6. æ–°å¢è¯­è¨€æ”¯æŒ

æ·»åŠ æ–°è¯­è¨€æ”¯æŒçš„æ­¥éª¤ï¼š

1. **æ›´æ–°é…ç½®**:
```yaml
i18n:
  support_languages: ["zh", "en", "ja"] # æ·»åŠ æ—¥æ–‡
```

2. **åˆ›å»ºæ¶ˆæ¯æ–‡ä»¶**:
```bash
touch locales/ja.yaml
```

3. **ç¿»è¯‘æ¶ˆæ¯**:
```yaml
# locales/ja.yaml
common:
  welcome:
    other: "ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼"
```

4. **æµ‹è¯•**:
```bash
curl -H "Accept-Language: ja" http://localhost:8080/api
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ¶ˆæ¯æœªç¿»è¯‘ï¼Œæ˜¾ç¤ºæ¶ˆæ¯é”®

**é—®é¢˜**: è¿”å› `errors.user_not_found` è€Œä¸æ˜¯ç¿»è¯‘åçš„æ¶ˆæ¯

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ¶ˆæ¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¯¹åº”çš„é”®
- ç¡®è®¤ YAML æ ¼å¼æ­£ç¡®ï¼ˆæ³¨æ„ç¼©è¿›ï¼‰
- éªŒè¯æ¶ˆæ¯æ–‡ä»¶è·¯å¾„é…ç½®

```bash
# æ£€æŸ¥æ¶ˆæ¯æ–‡ä»¶
ls -la locales/
cat locales/zh.yaml | grep user_not_found
```

#### 2. è¯­è¨€æ£€æµ‹ä¸ç”Ÿæ•ˆ

**é—®é¢˜**: è®¾ç½®äº† Accept-Language ä½†ä»ä½¿ç”¨é»˜è®¤è¯­è¨€

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤ä¸­é—´ä»¶å·²æ­£ç¡®æ³¨å†Œ
- æ£€æŸ¥ Accept-Language æ ¼å¼
- æŸ¥çœ‹é…ç½®ä¸­çš„ `accept_languages` åˆ—è¡¨

```bash
# è°ƒè¯•è¯­è¨€æ£€æµ‹
curl -v -H "Accept-Language: en-US,en;q=0.9" http://localhost:8080/api
# æ£€æŸ¥å“åº”å¤´ä¸­çš„ Content-Language
```

#### 3. æ„å»ºå¤±è´¥

**é—®é¢˜**: Wire ç”Ÿæˆå¤±è´¥æˆ–ç¼–è¯‘é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°ç”Ÿæˆ Wire ä»£ç 
make wire

# æ£€æŸ¥ä¾èµ–
go mod tidy

# é‡æ–°æ„å»º
make build
```

#### 4. æ¶ˆæ¯æ–‡ä»¶åŠ è½½å¤±è´¥

**é—®é¢˜**: å¯åŠ¨æ—¶æŠ¥å‘Šæ— æ³•åŠ è½½æ¶ˆæ¯æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæƒé™
- ç¡®è®¤ YAML è¯­æ³•æ­£ç¡®
- æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

```bash
# éªŒè¯ YAML è¯­æ³•
yamllint locales/zh.yaml

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la locales/
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

```go
// åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨ debug æ—¥å¿—
logger.Debug("I18n translation", 
    zap.String("messageID", messageID),
    zap.String("language", lang),
    zap.Any("templateData", templateData))
```

#### 2. æµ‹è¯•ç‰¹å®šè¯­è¨€

```go
// åˆ›å»ºæµ‹è¯•å‡½æ•°éªŒè¯ç¿»è¯‘
func TestI18nTranslation(t *testing.T) {
    i18n, err := i18n.New(i18n.Config{
        DefaultLanguage: "zh",
        SupportLangs:    []string{"zh", "en"},
        MessagesPath:    "./locales",
    })
    require.NoError(t, err)
    
    ctx := i18n.SetLanguageToContext(context.Background(), "zh")
    msg := i18n.T(ctx, "errors.user_not_found", nil)
    assert.Equal(t, "ç”¨æˆ·ä¸å­˜åœ¨", msg)
}
```

#### 3. éªŒè¯æ¶ˆæ¯å®Œæ•´æ€§

```bash
# æ¯”è¾ƒä¸¤ä¸ªè¯­è¨€æ–‡ä»¶çš„é”®æ˜¯å¦ä¸€è‡´
diff <(grep -E '^[[:space:]]*[^#].*:' locales/zh.yaml | sed 's/:.*//') \
     <(grep -E '^[[:space:]]*[^#].*:' locales/en.yaml | sed 's/:.*//') 
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. æ¶ˆæ¯é¢„åŠ è½½

æ¶ˆæ¯æ–‡ä»¶åœ¨å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ï¼Œè¿è¡Œæ—¶æ—  IO å¼€é”€ã€‚

#### 2. æœ¬åœ°åŒ–å™¨ç¼“å­˜

æ¯ç§è¯­è¨€çš„ Localizer å®ä¾‹ä¼šè¢«ç¼“å­˜ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚

#### 3. Context ä¼ é€’ä¼˜åŒ–

è¯­è¨€ä¿¡æ¯å­˜å‚¨åœ¨ Context ä¸­ï¼Œé¿å…é¢‘ç¹è§£æ HTTP Headerã€‚

---

## æ€»ç»“

æœ¬é¡¹ç›®çš„ i18n å®ç°æä¾›äº†å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- ğŸš€ **æ˜“äºä½¿ç”¨** - ç®€æ´çš„ API å’Œä¸­é—´ä»¶è‡ªåŠ¨å¤„ç†
- ğŸ”§ **çµæ´»é…ç½®** - æ”¯æŒå¤šç§é…ç½®æ–¹å¼å’Œç¯å¢ƒå˜é‡
- ğŸ“ **ç»“æ„åŒ–æ¶ˆæ¯** - å±‚çº§åŒ–çš„æ¶ˆæ¯ç»„ç»‡å’Œç®¡ç†
- ğŸŒ **æ ‡å‡†å…¼å®¹** - ç¬¦åˆ HTTP Accept-Language æ ‡å‡†
- âš¡ **é«˜æ€§èƒ½** - å†…å­˜ç¼“å­˜å’Œé¢„åŠ è½½ä¼˜åŒ–
- ğŸ” **æ˜“äºè°ƒè¯•** - å®Œå–„çš„æ—¥å¿—å’Œé”™è¯¯å¤„ç†

é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„æŒ‡å¯¼ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°ä¸ºåº”ç”¨æ·»åŠ å¤šè¯­è¨€æ”¯æŒï¼Œæä¾›æ›´å¥½çš„å›½é™…åŒ–ç”¨æˆ·ä½“éªŒã€‚